<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jestil</title>

    <script src="js/displayJob.js"></script>
    <script src="bower_components/jsPlumb/dist/js/jsPlumb-2.0.7-min.js"></script>


    <style>
        #diagramContainer {
            position: relative;
            width: 80%;
            height: 400px;
            border: 1px solid gray;
        }

        .activity {
            top: 20px;
            position: absolute;
            height: 80px;
            min-width: 80px;
            text-align: center;
        }

        .activity-icon {
            width: 50px;
            height: 50px;
        }
    </style>

</head>
<body>

<div id="diagramContainer">
    <div id="item_right" class="activity" style="left:150px">
        <img class="activity-icon" src="assets/icons/diagram.png">
        <div class="activity-name">Map 2 Pivot</div>
    </div>
    <div id="item_left" class="activity">
        <img class="activity-icon" src="assets/icons/oil.png">
        <div class="activity-name">Queue Listener</div>
    </div>
</div>


<script type="text/javascript">

    jsPlumb.ready(function () {
        var plumbInstance = jsPlumb.getInstance();
        var endpointInputOpts = {isSource: false, isTarget: true, connector : "Straight"};
        var endpointOutputOpts = {isSource: true, isTarget: false, connector : "Straight"};

        plumbInstance.importDefaults({
            PaintStyle: {
                lineWidth: 6,
                strokeStyle: "#567567",
                outlineColor: "black",
                outlineWidth: 1
            }
        });

        jsPlumb.draggable("item_left", {containment: true, grid: [5, 5]});
        jsPlumb.addEndpoint("item_left", {anchor: "Right"}, endpointOutputOpts);
        jsPlumb.addEndpoint("item_left", {anchor: "Left"}, endpointInputOpts);

        jsPlumb.draggable("item_right", {containment: true, grid: [5, 5]});
        jsPlumb.addEndpoint("item_right", {anchor: "Right"}, endpointOutputOpts);
        jsPlumb.addEndpoint("item_right", {anchor: "Left"}, endpointInputOpts);

    });

    /*displayJob(graph, {
     "name": "Book2Collection_job",
     "id": 1,
     "starter": "JMSListen1",
     "activities": {
     "JMSListen1": {
     "id": "JMSListen1",
     "type": "JMSListen",
     "name": "Queue Listener",
     "params": {
     "connection": {
     "port": 61613,
     "host": "127.0.0.1"
     },
     "destination": "/queue/test"
     },
     "transitions": ["MapTransform1"]
     },
     "MapTransform1": {
     "id": "MapTransform1",
     "type": "MapTransform",
     "name": "Book2Pivot",
     "input": {"_jsonPath": "$.JMSListen1.content"},
     "params": {
     "mapping": {
     "myBooks": {
     "authors": {"_jsonPath": "$.store.book[*].author"},
     "titles": {"_jsonPath": "$.store.book[*].title"},
     "totalPrice": {
     "_jsonPath": "$.store.book[*].price",
     "_transformation": "(arr) => arr.reduce((pre, curr) => pre + curr)"
     },
     "favouriteBook": {"_jsonPath": "$..book[3]"}
     }
     }
     },
     "transitions": ["Log1"]
     },
     "Log1": {
     "id": "Log1",
     "type": "Log",
     "name": "Log result",
     "input": {
     "result": {
     "_jsonPath": "$.Map_Transform1.myBooks.totalPrice",
     "_transformation": "(res) => parseInt(res) + 1000"
     }
     },
     "transitions": ["JMSAcknowledge1"]
     },
     "JMSAcknowledge1": {
     "id": "JMSAcknowledge1",
     "type": "JMSAcknowledge",
     "name": "ACK",
     "input": {"_jsonPath": "$.JMSListen1"},
     "params": {
     "target": "JMSListen1"
     },
     "transitions": []
     }
     }
     })*/


</script>

</body>
</html>